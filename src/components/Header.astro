---
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/recipes', label: 'Recipes' },
  { href: '/categories', label: 'Categories' },
  { href: '/about', label: 'About' },
];

const pathname = Astro.url.pathname;

function isActive(href: string) {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
}
---

<header class='site-header'>
  <div class='container'>
    <div class='site-header__inner'>
      <a href='/' class='site-header__brand'>Aimée's Recipe Book</a>

      <!-- Desktop nav -->
      <nav class='site-nav' aria-label='Main navigation'>
        <ul class='site-nav__list'>
          {
            navLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  class='site-nav__link'
                  aria-current={isActive(link.href) ? 'page' : undefined}>
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>

      <!-- Hamburger button (mobile only) -->
      <button
        class='nav-toggle'
        id='nav-toggle'
        type='button'
        aria-label='Open navigation menu'
        aria-expanded='false'
        aria-controls='mobile-nav'>
        <span class='nav-toggle__bar'></span>
        <span class='nav-toggle__bar'></span>
        <span class='nav-toggle__bar'></span>
      </button>
    </div>
  </div>
</header>

<!-- Mobile nav overlay -->
<div class='mobile-nav-overlay' id='mobile-nav-overlay' aria-hidden='true'>
</div>

<!-- Mobile nav drawer -->
<nav
  class='mobile-nav'
  id='mobile-nav'
  aria-label='Mobile navigation'
  aria-hidden='true'>
  <div class='mobile-nav__header'>
    <span class='mobile-nav__brand'>Aimée's Recipe Book</span>
    <button
      class='mobile-nav__close'
      id='nav-close'
      type='button'
      aria-label='Close navigation menu'>
      <svg
        width='24'
        height='24'
        viewBox='0 0 24 24'
        fill='none'
        stroke='currentColor'
        stroke-width='2'
        stroke-linecap='round'
        aria-hidden='true'>
        <path d='M18 6 6 18M6 6l12 12'></path>
      </svg>
    </button>
  </div>
  <ul class='mobile-nav__list'>
    {
      navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class='mobile-nav__link'
            aria-current={isActive(link.href) ? 'page' : undefined}>
            {link.label}
          </a>
        </li>
      ))
    }
  </ul>
</nav>

<script>
  const toggle = document.getElementById('nav-toggle')!;
  const closeBtn = document.getElementById('nav-close')!;
  const drawer = document.getElementById('mobile-nav')!;
  const overlay = document.getElementById('mobile-nav-overlay')!;

  function openNav() {
    drawer.classList.add('mobile-nav--open');
    overlay.classList.add('mobile-nav-overlay--visible');
    drawer.setAttribute('aria-hidden', 'false');
    overlay.setAttribute('aria-hidden', 'false');
    toggle.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
    closeBtn.focus();
  }

  function closeNav() {
    drawer.classList.remove('mobile-nav--open');
    overlay.classList.remove('mobile-nav-overlay--visible');
    drawer.setAttribute('aria-hidden', 'true');
    overlay.setAttribute('aria-hidden', 'true');
    toggle.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
    toggle.focus();
  }

  toggle.addEventListener('click', openNav);
  closeBtn.addEventListener('click', closeNav);
  overlay.addEventListener('click', closeNav);

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && drawer.classList.contains('mobile-nav--open')) {
      closeNav();
    }
  });
</script>
