---
import BaseLayout from '../../layouts/BaseLayout.astro';
import RecipeCard from '../../components/RecipeCard.astro';
import { getCollection } from 'astro:content';
import {
  getAllCuisines,
  slugifyCategory,
  getRecipeSlug,
} from '../../utils/categories';

export async function getStaticPaths() {
  const cuisines = await getAllCuisines();
  const allRecipes = await getCollection('recipes');

  return cuisines.map((cuisine) => {
    const recipes = allRecipes
      .filter(
        (r) =>
          r.data.cuisine && slugifyCategory(r.data.cuisine) === cuisine.slug,
      )
      .sort((a, b) => b.data.datePublished.localeCompare(a.data.datePublished));

    return {
      params: { slug: cuisine.slug },
      props: { cuisine, recipes },
    };
  });
}

const { cuisine, recipes } = Astro.props;
---

<BaseLayout
  title={`${cuisine.name} Recipes`}
  description={`Browse all ${cuisine.name} recipes in AimÃ©e's Recipe Book.`}>
  <div class='container'>
    <nav aria-label='Breadcrumb' style='padding-top: var(--space-6);'>
      <ol class='breadcrumb'>
        <li><a href='/'>Home</a></li>
        <li><a href='/cuisine'>Cuisine</a></li>
        <li aria-current='page'>{cuisine.name}</li>
      </ol>
    </nav>

    <div class='page-hero' style='padding-top: var(--space-4);'>
      <h1 class='page-hero__title'>{cuisine.name}</h1>
      <p class='page-hero__subtitle'>
        {recipes.length} recipe{recipes.length === 1 ? '' : 's'}
      </p>
    </div>

    {
      recipes.length === 0 ? (
        <div class='no-results'>
          <div class='no-results__icon'>ğŸ½ï¸</div>
          <p class='no-results__text'>No recipes for this cuisine yet.</p>
        </div>
      ) : (
        <div class='recipe-grid'>
          {recipes.map((recipe) => (
            <RecipeCard
              title={recipe.data.title}
              slug={getRecipeSlug(recipe.id)}
              description={recipe.data.description}
              categories={recipe.data.categories}
              heroImage={recipe.data.heroImage}
              datePublished={recipe.data.datePublished}
              times={recipe.data.times}
              difficulty={recipe.data.difficulty}
            />
          ))}
        </div>
      )
    }

    <div style='margin-top: var(--space-10); text-align: center;'>
      <a href='/cuisine' class='btn btn--outline'>â† All Cuisines</a>
    </div>
  </div>
</BaseLayout>
